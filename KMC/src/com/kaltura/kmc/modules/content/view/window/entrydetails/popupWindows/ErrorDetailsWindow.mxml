<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml"
				layout="vertical" styleName="TitleWindowType2"
				backgroundColor="#f7f7f7"
				width="360" height="230"
				showCloseButton="true" close="onClose()" creationComplete="onCreationComplete()">
	<mx:Script>
		<![CDATA[
			import mx.containers.VBox;
			import mx.containers.ViewStack;
			import mx.controls.Label;
			import mx.controls.LinkButton;
			import mx.core.Container;
			import mx.managers.PopUpManager;
			public static const MISSING_THUMB_ERROR:String = "missingThumbError";
			public static const MISSING_FLAVOR_ERROR:String = "missingFlavorError";
			public static const METADATA_ERROR:String = "metadataError";
			public static const MISSING_METADATA:String = "missingMetadataError";
			public static const GENERAL_ERROR:String = "generalError";
			
			private var _type:String;
			public var viewStack:ViewStack;
			[Bindable]
			private var _visibleBtn:Boolean = false;
			[Bindable]
			private var _btnText:String;
			[Bindable]
			private var _infoLabel:String;
			[Bindable]
			private var _extraInfoLabel:String;
			private var _isFirstParam:Boolean = true;
			[Bindable]
			public var enableLinks:Boolean = false;
			[Bindable]
			public var showCustomDataBtn:Boolean = false;
			
			
			private function onCreationComplete():void {
				this.mx_internal::closeButton.buttonMode = true;
			}
			
			public function setType(type:String):void {
				var st:String;
				_type = type;
				switch (_type) {
					case MISSING_THUMB_ERROR:
						_infoLabel = resourceManager.getString('cms','missingDimensions');
						_extraInfoLabel = resourceManager.getString('cms','gotoThumbnailTabMsg');
						st = resourceManager.getString('cms','gotoThumbnailTab');
						break;
					case MISSING_FLAVOR_ERROR:
						_infoLabel = resourceManager.getString('cms','missingFlavors');
						_extraInfoLabel = resourceManager.getString('cms','gotoFlavorTabMsg');
						st = resourceManager.getString('cms','gotoFlavorTab');
						break;
					case MISSING_METADATA:
						_infoLabel = resourceManager.getString('cms','missingMetadataMsg');
						_extraInfoLabel = resourceManager.getString('cms','gotoMetadataTabMsg');
						st = resourceManager.getString('cms','gotoMetadataTab');
						break;
					case METADATA_ERROR:
						_infoLabel = resourceManager.getString('cms','invalidMetadata');
						_extraInfoLabel = resourceManager.getString('cms','gotoMetadataTabMsgInvalid');
						st = resourceManager.getString('cms','gotoMetadataTab');
						break;
				}
				
				_btnText = st;
				if (_btnText) {
					_visibleBtn = true;
				}
				else {
					_visibleBtn = false;
				}
			}
			
			public function setGeneralLabel(error:String):void {
				_infoLabel = error;
			}
			
			private function onLinkClick(event:Event):void {
				switch (_type) {
					case MISSING_THUMB_ERROR:
						setSelectedChild("entryThumbnails");
						break;
					case MISSING_FLAVOR_ERROR:
						setSelectedChild("entryAssets")
						break;
					case MISSING_METADATA:
					case METADATA_ERROR:
						if (event.target==linkBtn) {
							setSelectedChild("entryMetaData")
						}
						else {
							setSelectedChild("customData")							
						}
						break;
				}
				PopUpManager.removePopUp(this);
			}
			
			private function setSelectedChild(childName:String):void {
				if (viewStack.getChildByName(childName))	
					viewStack.selectedChild = viewStack.getChildByName(childName) as Container;
			}
			
			private function onClose():void {
				PopUpManager.removePopUp(this);
			}
			
			/**
			 * adds the given string to the window
			 * */
			public function addErrorDetail(error:String, addInNewLine:Boolean = false):void {
				if (!addInNewLine) {
					if (_isFirstParam){
						_infoLabel += error;
						_isFirstParam = false;
					}
					else {
						_infoLabel += ", " + error;
					}
				}
				else {
					_infoLabel += '\n'+error;
				}
			}
			
		]]>
	</mx:Script>
	<!--<mx:VBox height="115" width="100%" styleName="distributionErrorVBox">-->
	<mx:Text  htmlText="{_infoLabel}" width="100%"/>
	<mx:Text text="{_extraInfoLabel}" width="100%" visible="{_visibleBtn}" includeInLayout="{_visibleBtn}"/>
	
	<!--	</mx:VBox>
	<mx:HBox height="100%" width="100%">-->
	<mx:ControlBar>
		
		<mx:LinkButton id="linkBtn" paddingLeft="0" label="{_btnText}" visible="{_visibleBtn &amp;&amp; enableLinks}" includeInLayout="{_visibleBtn &amp;&amp; enableLinks}" 
					   click="{onLinkClick(event)}"/>
		<mx:Spacer width="100%"/>
		<mx:LinkButton id="customDataBtn" label="{resourceManager.getString('cms','gotoCustomDataTab')}" paddingRight="0"
					   visible="{showCustomDataBtn &amp;&amp; enableLinks}" includeInLayout="{showCustomDataBtn &amp;&amp; enableLinks}"
					   click="{onLinkClick(event)}"/>
	</mx:ControlBar>
	
	<!--	</mx:HBox>-->
</mx:TitleWindow>
